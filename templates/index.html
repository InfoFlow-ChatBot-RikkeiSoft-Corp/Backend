<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‰´ìŠ¤ ë²¡í„° DB êµ¬ì¶• ë° ê²€ìƒ‰</title>
</head>
<body>
    <h2>ë‰´ìŠ¤ ë²¡í„° DB êµ¬ì¶• ë° ê²€ìƒ‰</h2>
    
    <!-- ë‰´ìŠ¤ ë§í¬ ì œì¶œ í¼ -->
    <h3>ğŸ”— ë‰´ìŠ¤ ë§í¬ ì¶”ê°€í•˜ê¸°</h3>
    <form action="/build-vector-db" method="POST">
        <label for="title">ì œëª© ì…ë ¥:</label>
        <input type="text" name="title" id="title" placeholder="ë‰´ìŠ¤ ì œëª©..." required>
        <br><br>
        <label for="url">ë‰´ìŠ¤ ë§í¬ ì…ë ¥:</label>
        <input type="text" name="url" id="url" placeholder="https://n.news.naver.com/article/..." required>
        <br><br>
        <button type="submit">ë²¡í„° DB êµ¬ì¶•</button>
    </form>
    
    <br><hr><br>
    
    <!-- ì§ˆë¬¸ ì…ë ¥ í¼ -->
    <h3>ğŸ“ ì§ˆë¬¸ ì…ë ¥í•˜ê¸°</h3>
    <form id="question-form">
        <label for="question">ì§ˆë¬¸ ì…ë ¥:</label>
        <input type="text" name="question" id="question" placeholder="ì˜ˆ: ì–´ì œ ì£¼ìš” ë‰´ìŠ¤ëŠ” ë¬´ì—‡ì¸ê°€ìš”?" required>
        <br><br>
        <button type="button" onclick="submitQuestion()">ì§ˆë¬¸ ì œì¶œ ë° ì‘ë‹µ ìƒì„±</button>
    </form>

    <!-- ì‘ë‹µ ê²°ê³¼ í‘œì‹œ -->
    <div id="query-result" style="margin-top: 20px; padding: 10px; border: 1px solid #ccc; border-radius: 5px; background-color: #f9f9f9;"></div>

    <br><hr><br>
    
    <!-- ì œì¶œëœ ë‰´ìŠ¤ ë¬¸ì„œ ë¦¬ìŠ¤íŠ¸ -->
    <h3>ğŸ”— ì œì¶œëœ ë‰´ìŠ¤ ë¬¸ì„œ:</h3>
    <ul id="docs-list">
        {% for doc in docs_list %}
            <li>
                <b>{{ doc.title }}</b> (ì œì¶œì¼: {{ doc.submitted_at.strftime('%Y-%m-%d %H:%M:%S') }}) - 
                <a href="{{ doc.url }}" target="_blank">{{ doc.url }}</a>
            </li>
        {% else %}
            <li>ì•„ì§ ë¬¸ì„œê°€ ì œì¶œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</li>
        {% endfor %}
    </ul>

    <!-- JavaScript -->
    <script>
        function submitQuestion() {
            const question = document.getElementById("question").value;
            fetch("/chat", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ question: question })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP Error: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                if (data.error) {
                    document.getElementById("query-result").innerHTML = `<p style="color:red;">âŒ ${data.error}</p>`;
                } else {
                    document.getElementById("query-result").innerHTML = `<p><b>ì‘ë‹µ:</b> ${data.answer}</p>`;
                }
            })
            .catch(error => {
                console.error("Error:", error);
                document.getElementById("query-result").innerHTML = `<p style="color:red;">âŒ ìš”ì²­ ì‹¤íŒ¨: ${error.message}</p>`;
            });
        }
        </script>        
</body>
</html>
