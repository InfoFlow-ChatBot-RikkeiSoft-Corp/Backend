<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>뉴스 벡터 DB 구축 및 검색</title>
</head>
<body>
    <h2>뉴스 벡터 DB 구축 및 검색</h2>
    
    <!-- 뉴스 링크 제출 폼 -->
    <h3>🔗 뉴스 링크 추가하기</h3>
    <form action="/build-vector-db" method="POST">
        <label for="title">제목 입력:</label>
        <input type="text" name="title" id="title" placeholder="뉴스 제목..." required>
        <br><br>
        <label for="url">뉴스 링크 입력:</label>
        <input type="text" name="url" id="url" placeholder="https://n.news.naver.com/article/..." required>
        <br><br>
        <button type="submit">벡터 DB 구축</button>
    </form>
    
    <br><hr><br>
    
    <!-- 질문 입력 폼 -->
    <h3>📝 질문 입력하기</h3>
    <form id="question-form">
        <label for="question">질문 입력:</label>
        <input type="text" name="question" id="question" placeholder="예: 어제 주요 뉴스는 무엇인가요?" required>
        <br><br>
        <button type="button" onclick="submitQuestion()">질문 제출 및 응답 생성</button>
    </form>

    <!-- 응답 결과 표시 -->
    <div id="query-result" style="margin-top: 20px; padding: 10px; border: 1px solid #ccc; border-radius: 5px; background-color: #f9f9f9;"></div>

    <br><hr><br>
    
    <!-- 제출된 뉴스 문서 리스트 -->
    <h3>🔗 제출된 뉴스 문서:</h3>
    <ul id="docs-list">
        {% for doc in docs_list %}
            <li>
                <b>{{ doc.title }}</b> (제출일: {{ doc.submitted_at.strftime('%Y-%m-%d %H:%M:%S') }}) - 
                <a href="{{ doc.url }}" target="_blank">{{ doc.url }}</a>
            </li>
        {% else %}
            <li>아직 문서가 제출되지 않았습니다.</li>
        {% endfor %}
    </ul>

    <!-- JavaScript -->
    <script>
        function submitQuestion() {
            const question = document.getElementById("question").value;
            fetch("/chat", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ question: question })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP Error: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                if (data.error) {
                    document.getElementById("query-result").innerHTML = `<p style="color:red;">❌ ${data.error}</p>`;
                } else {
                    document.getElementById("query-result").innerHTML = `<p><b>응답:</b> ${data.answer}</p>`;
                }
            })
            .catch(error => {
                console.error("Error:", error);
                document.getElementById("query-result").innerHTML = `<p style="color:red;">❌ 요청 실패: ${error.message}</p>`;
            });
        }
        </script>        
</body>
</html>
